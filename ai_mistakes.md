# AI 编码错误黑名单（持续更新）

> 目标：
> - 记录 AI 已犯过的真实错误
> - 在未来所有 AI 代码生成中强制规避
> - 所有规则必须【可执行】

---

## R000｜新增代码不得产生任何 IDE 报错或警告

- 范围：
  - TypeScript / JavaScript
  - Python
  - JSON / YAML / CSS

- 禁止行为：
  - ❌ 忽略红线错误（error）
  - ❌ 忽略黄线警告（warning）
  - ❌ “先跑起来再说”

- 强制要求：
  - ✅ AI 新增代码必须 0 error / 0 warning
  - ✅ 如存在警告，必须解释原因并给出修复方案
  - ✅ 无法消除的 warning 必须显式说明并获得确认


## M001｜多余逗号导致语法错误
- 🧠 AI 行为：新增参数、对象字段时顺手多加逗号
- 💥 后果：代码直接无法运行
- 🛑 禁止行为：
  - 禁止整段重写 object / dict / 参数列表
- ✅ 解决策略：
  - 修改前必须给出 diff
  - 新增内容必须单行展示

---

## M002｜缩进错误导致逻辑错位（Python / YAML）
- 🧠 AI 行为：调整代码时“顺手格式化”
- 💥 后果：逻辑改变但无语法报错
- 🛑 禁止行为：
  - 禁止改变已有代码的缩进
- ✅ 解决策略：
  - 明确标注插入位置
  - 不允许格式化已有代码

---

## M003｜覆盖已有逻辑
- 🧠 AI 行为：为“优化结构”删除旧代码
- 💥 后果：历史功能丢失
- 🛑 禁止行为：
  - 禁止删除任何已有逻辑
- ✅ 解决策略：
  - 只允许 append
  - 替换必须二次确认

---

## M004｜上下文遗忘导致回滚
- 🧠 AI 行为：只关注当前问题
- 💥 后果：前面写的功能被破坏
- 🛑 禁止行为：
  - 禁止跨文件“顺带修改”
- ✅ 解决策略：
  - 修改前必须复述现有逻辑


## M005｜导入路径错误
- 🧠 AI 行为：移动/重命名文件后忘记更新相关的 `import` 语句
- 💥 后果：`ModuleNotFoundError`、`Cannot find module`
- ✅ 解决策略：修改文件位置后必须检查所有引用该文件的 import

---

## M006｜类型定义与实际使用不匹配
- 🧠 AI 行为：添加新字段/属性时只修改了使用处，忘记更新 `types.ts` 或接口定义
- 💥 后果：TypeScript 编译错误
- ✅ 解决策略：新增字段必须同步更新类型定义和翻译文件（i18n）

---

## M007｜异步操作未正确处理
- 🧠 AI 行为：调用 API 后未 `await`，或忘记在 `useEffect` 中处理依赖数组
- 💥 后果：数据未刷新、状态不同步
- ✅ 解决策略：涉及状态刷新的操作必须明确回调时机

---

## M008｜硬编码字符串遗漏 i18n
- 🧠 AI 行为：快速实现功能时直接写中文 toast 消息
- 💥 后果：国际化不完整
- ✅ 解决策略：所有用户可见文字必须使用 i18n key

---

## M009｜依赖版本兼容性问题
- 🧠 AI 行为：直接安装最新版依赖，忽略 Node/Python 版本要求
- 💥 后果：依赖安装失败或运行时不兼容
- ✅ 解决策略：安装依赖前必须检查版本兼容性矩阵

---

## M010｜组件/函数删除但引用残留
- 🧠 AI 行为：删除组件后未清理调用处
- 💥 后果：编译失败
- ✅ 解决策略：删除任何定义前必须全局搜索引用

---

## M011｜滥用 `any` 类型绕过类型检查
- 🧠 AI 行为：遇到复杂类型时直接使用 `any` 或 `as any` 强制转换
- 💥 后果：
  - 失去 TypeScript 类型保护，运行时报错
  - ESLint 警告 `@typescript-eslint/no-explicit-any`
  - IDE 自动补全失效
- 🛑 禁止行为：
  - ❌ 使用 `any` 作为函数参数/返回值类型
  - ❌ 使用 `as any` 强制类型断言
  - ❌ 使用 `// @ts-ignore` 忽略类型错误
- ✅ 解决策略：
  - 优先使用具体类型或泛型 `<T>`
  - 不确定类型时使用 `unknown` 并进行类型守卫
  - 第三方库缺少类型时安装 `@types/xxx` 或声明 `.d.ts`

---

## M012｜代码编辑导致语法截断
- 🧠 AI 行为：使用 `replace_file_content` 时选区错误，删除了函数签名或闭合符号
- 💥 后果：`Syntax Error`，代码结构被破坏（如 Component 变成了仅剩 JSX）
- 🛑 禁止行为：
  - ❌ 仅替换函数体内部却选中了函数定义行
  - ❌ 替换时遗漏闭合括号/分号
- ✅ 解决策略：
  - 替换前仔细检查 StartLine/EndLine 包含的内容
  - 替换内容要包含完整的语法结构（如 `export const ...`）
  - 修改后立即运行 Lint 或编译检查

---

## M013｜JSX 逻辑运算误用
- 🧠 AI 行为：误以为 JSX 元素（如 `<div />`）在布尔运算中会像 `null` 一样表现
- 💥 后果：逻辑回退失效（`return <span>...</span> || <Fallback />` 永远返回前者，即使内容为空）
- 🛑 禁止行为：
  - ❌ 直接对 JSX 元素做 `||` 运算
- ✅ 解决策略：
  - 使用条件渲染 `condition ? <A /> : <B />`

---

## M014｜环境配置未同步至 Deployment
- 🧠 AI 行为：只修改了代码中的 `.env` 加载逻辑或 `.env` 文件，忘记更新 `docker-compose.yml` 或 K8s 配置
- 💥 后果：运行时环境变量缺失（Frontend/Backend 500 Error），且 `.env` 通常被 gitignore 导致部署无效
- 🛑 禁止行为：
  - ❌ 新增 `os.getenv` / `process.env` 后不检查部署配置
- ✅ 解决策略：
  - 新增环境变量时，必须同步检查并更新 `docker-compose.yml` 的 `environment` 列表
  - 如果是敏感变量，需提醒用户在生产环境 Dashboard/Secrets 中配置